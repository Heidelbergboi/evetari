{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block extra_head %}
<!-- Load Font Awesome for icons -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-fn/7L4gOTn9J96x9e8f3Tx6KIRiWcILZbJ7YGH6JX05Clz//aHVKLEZ7rKZ6AB54CLwO6apm/x81OW2bZpwZvg=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Load Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<!-- Load Select2 CSS for searchable dropdown -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

<style>
  body {
    background: #f8fafc;
    font-family: 'Inter', sans-serif;
  }
  .page-title {
    text-align: center;
    margin-top: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    color: #1a202c;
  }
  .page-subtitle {
    text-align: center;
    font-size: 1.125rem;
    color: #4a5568;
    margin-bottom: 2rem;
  }
  .dashboard-container {
    margin-bottom: 3rem;
  }
  .pref-card {
    background: #fff;
    border-radius: 1rem;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .pref-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
  }
  .pref-card-header {
    padding: 1.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 1.5rem;
    color: #fff;
    position: relative;
  }
  .pref-card-header--twitter {
    background: linear-gradient(135deg, #1DA1F2, #0d8cea);
  }
  .pref-card-header--facebook {
    background: linear-gradient(135deg, #1877F2, #0b5cb4);
  }
  .pref-card-header i {
    margin-right: 0.75rem;
  }
  .pref-card-body {
    padding: 1.75rem;
  }
  .pref-card-footer {
    background: #f1f5f9;
    padding: 1rem 1.5rem;
    border-top: 1px solid #e2e8f0;
  }
  .form-label {
    font-weight: 500;
    color: #2d3748;
  }
  .form-control, .form-select {
    border-radius: 0.5rem;
    border: 1px solid #cbd5e0;
    padding: 0.75rem;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  .form-control:focus, .form-select:focus {
    border-color: #6b46c1;
    box-shadow: 0 0 0 0.2rem rgba(107,70,193,0.25);
  }
  .form-control::placeholder {
    color: #a0aec0;
  }
  .btn-update {
    background-color: #6b46c1;
    color: #fff;
    border: none;
    border-radius: 0.5rem;
    padding: 0.75rem 2rem;
    font-size: 1rem;
    font-weight: 500;
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: block;
    margin: 1.5rem auto 0;
  }
  .btn-update:hover {
    background-color: #553c9a;
    transform: translateY(-2px);
  }
  .btn-delete-all {
    background-color: transparent;
    color: #dc2626;
    border: 1px solid #dc2626;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
    margin-top: 0.5rem;
  }
  .btn-delete-all:hover {
    background-color: #dc2626;
    color: #fff;
  }
  .selected-prefs {
    margin-top: 1rem;
  }
  .selected-prefs h5 {
    font-size: 1.125rem;
    margin-bottom: 0.75rem;
    font-weight: 600;
    color: #2d3748;
  }
  .selected-prefs ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .selected-prefs li {
    border-bottom: 1px solid #e2e8f0;
    padding: 0.5rem 0;
    font-size: 0.95rem;
    color: #4a5568;
  }
  @media (max-width: 768px) {
    .pref-card-header {
      font-size: 1.25rem;
    }
    .btn-update, .btn-delete-all {
      width: 100%;
    }
  }
</style>
{% endblock %}
{% block content %}
<div class="container dashboard-container">
  <h1 class="page-title">Social Preferences Dashboard</h1>
  <p class="page-subtitle">Customize your Twitter and Facebook profiles for an enhanced experience.</p>
  <div class="row g-4">
    <!-- Twitter Preferences Column -->
    <div class="col-lg-6">
      <div class="pref-card">
        <div class="pref-card-header pref-card-header--twitter">
          <i class="fab fa-twitter"></i> Twitter Preferences
        </div>
        <div class="pref-card-body">
          <form method="POST">
            {{ twitter_form.hidden_tag() }}
            <div class="mb-3">
              <label for="{{ twitter_form.twitter1.id }}" class="form-label">Twitter Profile 1</label>
              {{ twitter_form.twitter1(class="form-control", placeholder="Enter Twitter handle (e.g. @example)") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.twitter2.id }}" class="form-label">Twitter Profile 2</label>
              {{ twitter_form.twitter2(class="form-control", placeholder="Enter Twitter handle") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.twitter3.id }}" class="form-label">Twitter Profile 3</label>
              {{ twitter_form.twitter3(class="form-control", placeholder="Enter Twitter handle") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.twitter4.id }}" class="form-label">Twitter Profile 4</label>
              {{ twitter_form.twitter4(class="form-control", placeholder="Enter Twitter handle") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.twitter5.id }}" class="form-label">Twitter Profile 5</label>
              {{ twitter_form.twitter5(class="form-control", placeholder="Enter Twitter handle") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.twitter_language.id }}" class="form-label">Preferred Twitter Language</label>
              {{ twitter_form.twitter_language(class="form-select") }}
            </div>
            <div class="mb-3">
              <label for="{{ twitter_form.scraper_interval.id }}" class="form-label">Scraper Interval (minutes)</label>
              {{ twitter_form.scraper_interval(class="form-select") }}
            </div>
            <button type="submit" name="submit_twitter" class="btn-update">Update Twitter Preferences</button>
          </form>
        </div>
        <div class="pref-card-footer">
          <div class="selected-prefs">
            <h5>Selected Twitter Profiles</h5>
            <ul>
              {% if user.twitter_profiles %}
                {% for tw_profile in user.twitter_profiles %}
                  <li>{{ tw_profile.twitter_handle }}</li>
                {% endfor %}
              {% else %}
                <li>No Twitter profiles selected.</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Facebook Preferences Column -->
    <div class="col-lg-6">
      <div class="pref-card">
        <div class="pref-card-header pref-card-header--facebook">
          <i class="fab fa-facebook-f"></i> Facebook Preferences
        </div>
        <div class="pref-card-body">
          <form method="POST">
            {{ facebook_form.hidden_tag() }}
            <div class="mb-3">
              <label for="{{ facebook_form.facebook_language.id }}" class="form-label">Preferred Facebook Language</label>
              {{ facebook_form.facebook_language(class="form-select") }}
            </div>
            <div class="mb-3">
              <label for="{{ facebook_form.scraper_interval.id }}" class="form-label">Scraper Interval (minutes)</label>
              {{ facebook_form.scraper_interval(class="form-select") }}
            </div>
            <div class="mb-4">
              <label class="form-label">Facebook Pages</label>
              <div id="facebook-pages-container">
                {% for fb_field in facebook_form.facebook_pages %}
                  <div class="mb-3">
                    <label class="form-label">Facebook Page {{ loop.index }}</label>
                    {{ fb_field(class="form-control", placeholder="Enter Facebook page URL") }}
                  </div>
                {% endfor %}
              </div>
              <button type="button" id="add-facebook-page" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-plus"></i> Add Facebook Page
              </button>
            </div>
            <button type="submit" name="update_facebook" class="btn-update">Update Facebook Preferences</button>
            <button type="submit" name="delete_all_facebook" class="btn-delete-all" onclick="return confirm('Are you sure you want to delete all Facebook preferences?');">Delete All Facebook Preferences</button>
          </form>
        </div>
        <div class="pref-card-footer">
          <div class="selected-prefs">
            <h5>Selected Facebook Pages</h5>
            <ul>
              {% if user.facebook_pages %}
                {% for fb_page in user.facebook_pages %}
                  <li>{{ fb_page.page_url }}</li>
                {% endfor %}
              {% else %}
                <li>No Facebook pages selected.</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_scripts %}
<!-- jQuery for the Add Facebook Page functionality -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    let fbPageCounter = {{ facebook_form.facebook_pages|length }};
    const addButton = document.getElementById("add-facebook-page");
    const container = document.getElementById("facebook-pages-container");

    addButton.addEventListener("click", function() {
      const newIndex = fbPageCounter;
      fbPageCounter++;

      const wrapper = document.createElement("div");
      wrapper.classList.add("mb-3");

      const label = document.createElement("label");
      label.classList.add("form-label");
      label.textContent = "Facebook Page " + (newIndex + 1);

      const input = document.createElement("input");
      input.type = "text";
      input.name = `facebook_pages-${newIndex}`;
      input.placeholder = "Enter Facebook page URL";
      input.classList.add("form-control");

      wrapper.appendChild(label);
      wrapper.appendChild(input);
      container.appendChild(wrapper);
    });
  });
</script>
{% endblock %}
